<p align="right">
  üåê <a href="https://www.superstarpestcontrol.com/" target="_blank"><u><strong>Visit Website</strong></u></a>
</p>

<p align="center">
  <img src="https://www.superstarpestcontrol.com/static/images/super_star_logo.png" alt="Project Logo" width="120"/>
</p>

<h1 align="center" style="font-size: 36px;"><strong>Super Star Pest Control Services</strong></h1>

<h3 align="center"><em>Comprehensive Documentation for Developers</em></h3>

<div align="center">

  
| Key                     | Value                                                   |
|--------------------------|-----------------------------------------------------------|
| **Project Name**         | Super Star Pest Control Services                         |
| **Developed By**         | Beginning Solutions                                      |
| **Client Name**          | Sanjay Gavhane                                           |
| **Client Company Name**  | Super Star Pest Control Services Pvt. Ltd                |
| **Created At**           | April 2025                                               |
| **Last Updated**         | May 5, 2025                                              |

</div>


## üìú Introduction

**Beginning Solutions** is a software company that developed this project, **Super Star Pest Control Services**. The project consists of two main components:

1. **Website for Users**: A user-friendly website for browsing and booking pest control services. This is accessible to customers who need pest control services from **Super Star Pest Control**.
   
2. **Comprehensive Admin Panel**: A dedicated admin panel for the company to manage and monitor bookings, services, customer interactions, and more. This panel is designed to give complete control to the business for managing operations.

The platform provides an easy-to-use **booking system** for pest control services offered by **Super Star Pest Control Services Pvt. Ltd**.


## üéØ Purpose

The primary goal of the **Super Star Pest Control Services** project is to provide an easy and efficient way for customers to book pest control services online. This platform enables seamless interaction between the customers and the company, **Super Star Pest Control Services Pvt. Ltd.**

### Key Objectives:
- **User Convenience**: Allow customers to book pest control services from anywhere, anytime, using an intuitive web interface.
- **Efficient Management**: Provide an **Admin Panel** for the company to manage customer requests, service bookings, and track job progress.
- **Service Transparency**: Ensure customers receive clear and detailed information about the available services, making it easy to choose the best solution for their needs.


## üìä Project Overview

**Super Star Pest Control Services** is a comprehensive platform that enables users to book pest control services conveniently through a website, while also providing an efficient admin panel for company management.

### **Website Features (User Side)**:
1. **Service Catalog**: The website showcases all the pest control services provided by **Super Star Pest Control Services Pvt. Ltd**. Each service comes with a detailed description, including its importance, frequency of service (e.g., after how many days the service should be repeated), and more.
   
2. **Slot Booking System**: Users can select a convenient time slot for their pest control service booking. The system ensures that the user gets the right time and date based on their preferences.
   
3. **Payment Integration**: After booking a slot, users can pay the required amount for the service using an integrated payment system, which ensures a seamless payment experience.

4. **Ongoing and Future Offers**: Users can view any ongoing offers and upcoming discounts directly on the website. This feature helps users take advantage of promotional deals.

### **Admin Panel Features (Company Side)**:
1. **Employee Assignment**: After a booking is made, the company manager or admin can assign an employee to the job for inspection and work completion. This ensures that every job is assigned to the right employee in a timely manner.

2. **Customer SMS Notifications**: Once a booking is made, the system automatically sends the customer details (name, phone, address, and service information) via SMS. This helps the assigned employee easily find the client's location and provide the service without delay.

3. **Service Management**: The admin panel allows the company to manage all aspects of the service, including customer interactions, job scheduling, and employee coordination.

### **How It Works**:
- **User Side**: Users can browse services, choose the service they need, select a time slot, and pay for the service online.
- **Admin Side**: After a booking, the admin assigns employees, tracks the progress of the job, and ensures smooth communication with the customer.

This system provides a seamless experience for both users and company managers, making pest control services more accessible and manageable.


## üîó Links

Here are the important links for accessing the **Super Star Pest Control Services** platform:

- **[Main Website](https://www.superstarpestcontrol.com/)**: Access the website where users can browse services, book slots, and make payments.
- **[Admin Panel](https://admin.superstarpestcontrol.com/)**: The dedicated admin panel where company managers and admins can manage bookings, assign employees, and track job progress.
- **[Django Default Admin Panel](https://superstarpestcontrol.com/supreme/)**: Access the Django default admin panel for advanced administrative controls (if necessary).


## ‚öôÔ∏è Tech Stack

The **Super Star Pest Control Services** project utilizes a variety of modern technologies for both the website and the admin panel. Below is the breakdown of the tech stack used:

### **Backend**:
- **Python**: The primary programming language used for backend development.
- **Django**: A high-level Python web framework that encourages rapid development and clean, pragmatic design.
- **Django REST Framework**: A powerful toolkit for building Web APIs in Django, which facilitates seamless integration between the backend and frontend.

### **Frontend (Website)**:
- **HTML**: For creating the basic structure of the web pages.
- **CSS**: For styling and layout of the web pages.
- **JavaScript**: For adding interactivity and functionality to the website.
- **jQuery**: A fast, small, and feature-rich JavaScript library that simplifies tasks such as DOM manipulation and event handling.
- **Bootstrap**: A popular open-source CSS framework for responsive, mobile-first web development.

### **Frontend (Admin Panel)**:
- **React**: A JavaScript library for building user interfaces, used for creating a dynamic and responsive admin panel.
- **Tailwind CSS**: A utility-first CSS framework used in the admin panel for rapid UI development and consistent styling.

### **Database**:
- **MySQL**: A relational database management system (RDBMS) used to store and manage all application data, including user information, bookings, and service details.

### **APIs & External Tools**:
- **SMTP**: For sending email notifications and alerts to users and admin.
- **Twilio**: For sending SMS notifications to users and employees about booking details and updates.
- **Razorpay**: For handling payments securely on the website, allowing users to pay for the services they book.
- **Google Maps API**: For integrating location-based services into the platform (e.g., showing the location of the customer).
- **Google Maps Reviews API**: For displaying customer reviews on the website related to pest control services.

### **System Architecture**:
- **Single Backend**: The backend is designed to handle both the website and the admin panel seamlessly. Django serves both user-facing services and admin panel functionalities through the same backend, using Django REST Framework to manage APIs and data exchange.


## ‚ú® Features

### **Website Features (User Side)**

1. **Service Catalog**:
   - The website showcases a comprehensive list of pest control services offered by **Super Star Pest Control Services**. Users can explore each service to understand its importance, frequency, and details about how it helps in pest control.
   
2. **Slot Booking System**:
   - Users can select their preferred date and time slot for the pest control service. This feature allows users to book a slot based on their convenience, making the service more user-friendly and flexible.

3. **Payment Integration**:
   - **Razorpay** integration allows users to securely pay for their booked services online. The payment process is smooth and quick, ensuring that users can confirm their bookings instantly after making the payment.

4. **Ongoing and Future Offers**:
   - The website displays current and upcoming offers on pest control services. Users can view the latest discounts, seasonal offers, and promotions, helping them save money while booking the services.

5. **Service Information**:
   - Each service page includes detailed information about why the service is important, how often it should be repeated, and the benefits it offers. This helps users make informed decisions about the pest control services they need.

---

### **Admin Panel Features (Company Side)**

1. **Employee Assignment**:
   - Once a user books a service, the admin or company manager can assign an employee to carry out the pest control work. The admin can track the progress and ensure that each booking is handled by the right personnel.

2. **Customer Details Management**:
   - After a user makes a booking, the admin panel collects and displays the customer‚Äôs details, including their name, phone number, and address. This information is crucial for assigning tasks and providing quality service.

3. **Customer SMS Notifications**:
   - Using **Twilio**, the admin panel sends SMS notifications to both the customer and the assigned employee. These messages include key details such as the customer‚Äôs name, address, and the assigned service. This ensures that everyone is informed and the service is completed on time.

4. **Booking Management**:
   - The admin can view and manage all user bookings. This includes modifying existing bookings, confirming payments, and updating the status of the service. The system ensures that everything is organized and efficient.

5. **Service Management**:
   - Admins can manage the services offered by **Super Star Pest Control Services**. They can add new services, update existing ones, or remove outdated services. This feature ensures that the website and admin panel are always up-to-date with the latest offerings.

6. **Performance Analytics**:
   - The admin panel includes reporting features where managers can track the performance of employees and services, view customer satisfaction, and assess the overall business performance. This helps in making data-driven decisions for business growth.

7. **Real-Time Updates**:
   - The admin panel is designed to provide real-time updates on bookings, payments, and task assignments. This helps the company stay responsive and efficient in managing daily operations.
   

### **Integrated Technologies in Features**:

- **Razorpay**: Seamless payment gateway integration for handling transactions.
- **Twilio**: SMS notifications for customer and employee updates.
- **Google Maps**: Integration to track and send the customer's location to the assigned employee for better navigation.


## ‚öôÔ∏è Installation and Setup

To run the **Super Star Pest Control Services** project, you can set it up either locally or on a server. Below are the detailed instructions:

### Running Locally

1. Navigate to the project directory:
   ```bash
   cd BSS02
   ```

2. Go to the `website` folder:
   ```bash
   cd website
   ```

3. Set up the Python virtual environment:
   ```bash
   venv\Scripts\activate
   ```
   The prompt should look like this:
   ```
   (venv) C:\GitHub\BSS02\website>
   ```

4. Install the required dependencies:
   ```bash
   pip install -r requirements.txt
   ```

5. Set up the `.env` file with the necessary credentials.

6. Apply database migrations:
   ```bash
   python manage.py makemigrations api
   python manage.py makemigrations
   python manage.py migrate
   ```

7. Start the Django development server:
   ```bash
   python manage.py runserver
   ```

8. Open the provided link in your browser to access the project locally.

### Running the Admin Panel Locally (React)

1. Navigate to the `admin_panel` directory:
   ```bash
   cd BSS02/admin_panel
   ```

2. Install Node.js dependencies:
   ```bash
   npm install
   ```

3. Start the React development server:
   ```bash
   npm start
   ```

### Running on a Server

To deploy and run the **Super Star Pest Control Services** website on a server, follow these steps:

1. Navigate to the project directory on the server:
   ```bash
   cd /path/to/project/BSS02
   ```

2. Go to the `website` folder:
   ```bash
   cd website
   ```

3. Activate the Python virtual environment:
   ```bash
   source venv/bin/activate
   ```

4. Install the required dependencies:
   ```bash
   pip install -r requirements.txt
   ```

5. Navigate to the folder containing the `manage.py` file (backend):
   ```bash
   cd /path/to/project/BSS02/website
   ```

6. Apply database migrations:
   ```bash
   python manage.py makemigrations api
   python manage.py makemigrations
   python manage.py migrate
   ```

7. Collect static files:
   ```bash
   python manage.py collectstatic
   ```

8. Start the Django server:
   ```bash
   python manage.py runserver 0.0.0.0:8000
   ```
   - Replace `8000` with any unused port on your server if needed.

> **Note**: The React admin panel cannot be run directly on the server using this method. For deploying the React admin panel, refer to the **Deployment** section.

--- 


## üóÇ Project Structure

The **Super Star Pest Control Services** project is organized into a structured hierarchy of directories and files to ensure clarity and ease of navigation. Below is the detailed breakdown of the project structure:

### **Root Directory: `website`**
- `.gitignore`: Git ignore file for managing untracked files.
- `backend/`: Contains the core backend logic, including Django apps.
- `requirements.txt`: Python dependencies required for the project.
- `venv/`: Python virtual environment folder.

---

### **Backend Directory: `website/backend`**
- `.env`: Environment variables file for sensitive data.
- `.env.example`: Example file for environment variables.
- `.gitignore`: Git ignore file specific to the backend.
- `manage.py`: Django's command-line utility for administrative tasks.
- `api/`: Contains the main API logic for the project.
- `backend/`: Core Django backend configuration files.
- `frontend/`: Handles templates, static files, and frontend logic.
- `media/`: Directory for storing uploaded files.

---

### **API Directory: `website/backend/api`**
- `admin.py`: Configuration for the admin interface.
- `apps.py`: Application configuration for the API app.
- `migrations/`: Contains database migration files.
- `models.py`: Django models defining the database schema.
- `serializers.py`: Serializers for converting data between Python objects and JSON.
- `tasks.py`: Celery tasks for background processing.
- `tests.py`: Unit tests for the API app.
- `urls.py`: URL routing for the API.
- `utils.py`: Utility functions used across the API.
- `views.py`: Django views handling HTTP requests and responses.

---

### **Backend Configuration Directory: `website/backend/backend`**
- `asgi.py`: ASGI configuration for asynchronous server deployment.
- `celery.py`: Celery configuration for task queues.
- `settings.py`: Core Django settings for the project.
- `urls.py`: URL routing for the backend.
- `wsgi.py`: WSGI configuration for web server deployment.

---

### **Frontend Directory: `website/backend/frontend`**
- `admin.py`: Configuration for the frontend admin interface.
- `apps.py`: Application configuration for the frontend app.
- `migrations/`: Contains database migration files for the frontend.
- `models.py`: Models related to frontend functionalities.
- `static/`: Contains static files (CSS, JS, images, etc.).
- `templates/`: Contains HTML templates for the frontend.
- `tests.py`: Unit tests for the frontend app.
- `urls.py`: URL routing for the frontend.
- `views.py`: Django views for rendering templates.

---

### **Frontend Templates Directory: `website/backend/frontend/templates`**
- `404.html`: Custom 404 error page.
- `about.html`: About Us page.
- `admin.html`: Template for the admin interface.
- `base.html`: Base template for consistent layouts.
- `blog.html`: Blog listing page.
- `blogs/`: Contains individual blog templates.
  - `blog01.html`, `blog02.html`, `blog03.html`: Blog content pages.
- `blog_details.html`: Detailed blog page.
- `booking_info.html`: Booking information page.
- `contact.html`: Contact Us page.
- `faq.html`: Frequently Asked Questions page.
- `includes/`: Includes reusable components.
  - `booking_form.html`, `feedback.html`, `footer.html`, `metatags.html`, `navbar.html`, `reviews.html`: Modular components for templates.
- `index.html`: Home page template.
- `offer.html`: Offers page.
- `offer_booking.html`: Offer booking page.
- `policy.html`: Privacy policy page.
- `service.html`: Services page.
- `services/`: Contains templates for individual services.
  - `anti_fungal_treatment.html`, `anti_termite_control.html`, `bed_bugs_control.html`, etc.
- `terms_conditions.html`: Terms and Conditions page.
- `thank_you.html`: Thank You page.

---

### **Frontend Static Directory: `website/backend/frontend/static`**
- `css/`: Stylesheets for the project.
  - `about.css`, `blog.css`, `contact.css`, `index.css`, `offer.css`, `services.css`, `style.css`
- `images/`: Images used throughout the project.
- `js/`: JavaScript files for frontend interactivity.
  - `about.js`, `contact.js`, `feedback.js`, `index.js`, `reviews.js`, `service.js`, `script.js`
- `json/`: JSON files for data representation.
- `videos/`: Videos displayed on the website.

---

This structure ensures the separation of concerns, making the project maintainable and scalable.


## üöÄ Usage

The **Super Star Pest Control Services** project is designed for both users and administrators. Below are the usage instructions for each type of user:

---

### **For Users (Website)**

1. **Browse Services**  
   Visit the website and explore the catalog of pest control services. Each service provides details such as benefits, frequency, and pricing.

2. **Book a Slot**  
   Select a service and choose a convenient time slot for the booking.

3. **Make Payments**  
   Complete your booking by making payments through the integrated payment gateway.

4. **View Offers**  
   Check for ongoing offers and discounts directly on the homepage.

5. **Customer Support**  
   Use the contact page or FAQs section for any queries or assistance.

---

### **For Administrators (Admin Panel)**

1. **Login**  
   Access the admin panel using your credentials.

2. **Manage Bookings**  
   View, edit, and assign employees to customer bookings.

3. **Send Notifications**  
   Automatically send SMS notifications to customers and employees upon booking assignments.

4. **Track Services**  
   Monitor the progress of ongoing services and ensure timely completion.

5. **Service Configuration**  
   Update service details, pricing, and offers as per business requirements.

---

### **For Developers**

1. **Setup the Project**  
   Follow the [Installation and Setup](#-installation-and-setup) instructions to run the project locally or on a server.

2. **Understand the Codebase**  
   Refer to the [Project Structure](#-project-structure) section for a detailed breakdown of the codebase.

3. **Extend Functionality**  
   - Add new features by creating new Django apps under the `backend/` directory.
   - Enhance the frontend by updating templates in the `frontend/templates/` directory or static assets in the `frontend/static/` directory.

4. **Debugging and Testing**  
   Use the provided `tests.py` files in both `api` and `frontend` directories to write and run tests for debugging and validation.


This project provides a seamless experience for all stakeholders‚Äîusers, administrators, and developers. Ensure to follow the documentation for proper usage and maintenance.


# üåê Website Frontend Documentation

This document provides a comprehensive guide to the **frontend** portion of the website for **Super Star Pest Control Services**. It includes a breakdown of the file structure, templates, static assets, and key components that power the user-facing side of the project.

---

## üóÇ Frontend Structure Overview

The frontend is designed using Django templates and static files such as CSS, JavaScript, images, and videos. Below is the organized structure of the frontend directory:

### **Frontend Directory: `website/backend/frontend`**
- **`admin.py`**: Admin configuration for the frontend app.
- **`apps.py`**: Application configuration for the frontend.
- **`migrations/`**: Contains migration files for database changes related to frontend functionalities.
- **`models.py`**: Models associated with the frontend (if any).
- **`static/`**: Contains all static assets (CSS, JavaScript, images, videos, etc.).
- **`templates/`**: Contains HTML templates for the frontend.
- **`tests.py`**: Unit tests for the frontend.
- **`urls.py`**: URL routing for the frontend.
- **`views.py`**: Views responsible for rendering templates and handling frontend logic.

---

## üñº Templates Directory: `frontend/templates`

The `templates/` directory contains HTML files organized for various pages and reusable components. 

### Key Templates:
- **`404.html`**: Custom 404 error page.
- **`about.html`**: Displays information about the company.
- **`admin.html`**: Admin-specific frontend interface.
- **`base.html`**: Base template for consistent layout across pages.
- **`blog.html`**: Blog listing page.
- **`blog_details.html`**: Detailed view of a single blog post.
- **`booking_info.html`**: Displays booking-related information for users.
- **`contact.html`**: Contact form and company details.
- **`faq.html`**: Frequently Asked Questions page.
- **`index.html`**: Homepage with a dynamic service and offer display.
- **`offer.html`**: Displays current offers.
- **`offer_booking.html`**: Enables users to book services with offers.
- **`policy.html`**: Privacy policy page.
- **`service.html`**: Showcases available pest control services.
- **`terms_conditions.html`**: Terms and conditions page.
- **`thank_you.html`**: Thank you page displayed after successful actions.

### Subdirectories:
1. **`blogs/`**: Contains individual blog templates:
   - `blog01.html`, `blog02.html`, `blog03.html`, etc.

2. **`services/`**: Contains templates for specific services:
   - `anti_fungal_treatment.html`
   - `anti_termite_control.html`
   - `bed_bugs_control.html`
   - `cockroach_control.html`
   - `rodent_control.html`
   - And more (total: 13 service templates).

3. **`includes/`**: Reusable components for modular design:
   - `booking_form.html`: Form for booking services.
   - `feedback.html`: Displays user feedback.
   - `footer.html`: Footer section for all pages.
   - `metatags.html`: Meta tags for SEO optimization.
   - `navbar.html`: Navigation bar for the website.
   - `reviews.html`: Section displaying customer reviews.

---

## üé® Static Files: `frontend/static`

The `static/` directory contains all the assets required for styling, scripts, and media.

### Subdirectories:
1. **`css/`**: Stylesheets for the website.
   - `about.css`: Styles for the About Us page.
   - `blog.css`: Styles for blog pages.
   - `contact.css`: Styles for the Contact Us page.
   - `index.css`: Styles for the homepage.
   - `offer.css`: Styles for the offers page.
   - `services.css`: Styles for the services page.
   - `style.css`: General styles used across the website.

2. **`js/`**: JavaScript files for interactivity.
   - `about.js`: Scripts for the About Us page.
   - `contact.js`: Scripts for the Contact Us page.
   - `feedback.js`: Scripts for feedback forms.
   - `index.js`: Homepage scripts.
   - `reviews.js`: Scripts for managing customer reviews.
   - `service.js`: Scripts for the services page.
   - `script.js`: General-purpose scripts.

3. **`images/`**: Contains all the images used in the project.

4. **`videos/`**: Contains video files displayed on the website.

5. **`json/`**: JSON files for data representation (if any).

---

## üîë Key Features

### **1. Responsive Design**
The frontend is built with responsiveness in mind, ensuring a seamless user experience across devices (desktop, tablet, mobile).

### **2. Modular Templates**
Templates are designed with reusability and modularity. Components like the navbar, footer, and booking form are included where needed, reducing redundancy.

### **3. Dynamic Content**
Pages like `index.html`, `service.html`, and `offer.html` dynamically display content fetched from the backend, ensuring up-to-date information for users.

### **4. Consistent Styling**
All pages share a consistent look and feel, achieved through the use of the `base.html` template and shared CSS files.

### **5. SEO Optimized**
Meta tags are included in the `metatags.html` component to improve the website's visibility in search engines.

---

## üõ† Development Workflow

1. **Modifying Templates**
   - Templates can be updated in the `frontend/templates/` directory.
   - Use the `includes/` directory for reusable components.

2. **Adding New Styles**
   - Add or modify CSS files in the `frontend/static/css/` directory.
   - Link the new styles in the corresponding template using `{% static %}` tags.

3. **Enhancing Interactivity**
   - Add JavaScript files in the `frontend/static/js/` directory.
   - Link the scripts in the corresponding template using `{% static %}` tags.

4. **Updating Media**
   - Add images to the `frontend/static/images/` directory.
   - Add videos to the `frontend/static/videos/` directory.
   - Reference media in templates using `{% static %}` tags.

---

## üë®‚Äçüíª For Developers

- **Navigation Across Templates**:  
  Use the `urls.py` file in the `frontend/` directory to define new routes for templates.

- **Testing Changes Locally**:  
  Run the Django development server and navigate through the website to verify changes.

- **Debugging Issues**:  
  Use the browser's developer tools to inspect elements, monitor network requests, and debug JavaScript.

---

This documentation covers all aspects of the website's frontend, ensuring developers and designers have a clear understanding of its structure and functionality.

# üõ† Backend Documentation

The **Super Star Pest Control Services** backend is built on Django, providing robust functionality for service management, booking systems, and administrative tasks. This document outlines the main libraries, environment configuration, dependencies, backend features, and installation steps.

---

## ‚ö° Backend Overview

The backend is responsible for the following functionalities:
- **Database Management**: Handles all user, service, booking, and company data using MySQL.
- **API Development**: Provides RESTful APIs for frontend integration.
- **Payment Processing**: Facilitates online payments using RazorPay.
- **Email Services**: Manages email notifications using SMTP.
- **Google Maps Integration**: Enables location-based services like address mapping and directions.
- **Task Scheduling**: Uses Celery for background tasks and periodic jobs.
- **Authentication**: Implements secure user authentication using JWT.

---

## üåç Environment Configuration

Below is an example `.env` file used for configuring the backend environment:

```ini name=.env.example
# Secret Key Configuration
SECRET_KEY=
DEBUG= 

# Database Configuration (MYSQL)
DB_NAME=
DB_USER=
DB_PASSWORD=
DB_HOST=
DB_PORT=

# Location Configuration (Google Maps)
GOOGLE_API_KEY=
PLACE_ID=

# Payment Gateway Configuration (RazorPay)
RAZORPAY_KEY_ID=
RAZORPAY_KEY_SECRET=

# Email Configuration (SMTP)
EMAIL_HOST_USER=
EMAIL_HOST_PASSWORD=
```

---

## üìö Main Libraries

Below are the primary libraries and frameworks used in the backend:

- **Django**: The main web framework for building the backend.
- **Django Rest Framework (DRF)**: For creating RESTful APIs.
- **Celery**: For managing asynchronous tasks and background jobs.
- **Redis**: Used as a message broker for Celery.
- **MySQL**: Database system for storing application data.
- **RazorPay**: Payment gateway integration for processing payments.
- **Twilio**: For SMS notifications.
- **Google Maps API**: Location-based features such as address lookups.

---

## üöÄ Backend Features

### **1. Database Management**
- Uses **MySQL** database with Django ORM for efficient data handling.
- Manages user accounts, bookings, services, and payment details.

### **2. API Development**
- Provides RESTful endpoints for frontend integration.
- Handles user authentication, service fetching, bookings, and payments.

### **3. Task Scheduling**
- Background tasks like email notifications, SMS updates, and job assignments are managed using Celery and Redis.

### **4. Payment Processing**
- Secure and seamless payment integration with RazorPay.

### **5. Notifications**
- Sends booking confirmations and updates via email (SMTP) and SMS (Twilio).

### **6. Google Maps Integration**
- Enables location-based features such as mapping addresses and calculating distances.

### **7. Security**
- Implements JWT Authentication for secure API access.
- Protects sensitive data using environment variables.

---

## üì¶ Dependencies

Below are some of the key dependencies used in the backend:

- **Django**: Core framework for backend development.
- **djangorestframework**: For building REST APIs.
- **celery**: Task queue for asynchronous jobs.
- **redis**: Message broker for Celery.
- **mysqlclient**: MySQL database adapter for Python.
- **razorpay**: Integration for RazorPay payment gateway.
- **twilio**: SMS notification service.
- **django-cors-headers**: To handle Cross-Origin Resource Sharing (CORS).
- **django-celery-beat**: Scheduler for periodic Celery tasks.
- **python-decouple**: For environment variable management.

---

## ‚öôÔ∏è Installation and Setup

Refer to the [Installation and Setup](#installation-and-setup) section for detailed instructions on how to set up and run the backend.

# üõ† Admin Panel Frontend Documentation

This document provides a comprehensive guide to the **Admin Panel Frontend** of **Super Star Pest Control Services**. The Admin Panel is designed to help administrators manage services, bookings, customer interactions, and employees efficiently. Below is the structured documentation of the frontend aspects of the Admin Panel.


# üìö API Documentation

This document provides a detailed guide for the APIs of **Super Star Pest Control Services**. It includes information about each endpoint, how to run the APIs, and how to test them using tools like Postman.

---

## üî∞ Introduction

The API is designed to provide a seamless backend for managing services, bookings, employees, and more. It is built using **Django Rest Framework (DRF)** and follows RESTful principles.

### **Key Features**
- **Authentication**: All endpoints require authentication using JWT tokens with the `Bearer` scheme.
- **CRUD Operations**: Create, Read, Update, and Delete resources like services, bookings, and employees.
- **Integration**: APIs for RazorPay, email notifications, Twilio and Google Maps.

---

## üöÄ How to Run the API

1. **Start the Development Server**:
   Run the following command to start the Django development server:
   ```bash
   python manage.py runserver
   ```

2. **Base URL**:
   The API is accessible at:
   ```
   http://127.0.0.1:8000/api/
   ```

3. **Authentication**:
   - Authentication is handled using **JWT Tokens**.
   - Obtain a token by logging in via the `/api/login/` endpoint.
   - Include the token in the `Authorization` header for all requests:
     ```
     Authorization: Bearer <token>
     ```

---

## üõ† Testing the API

You can test the API using tools like **Postman** or **cURL**.

### **Using Postman**
1. Import the API endpoints into Postman manually or via a collection file.
2. Add the required headers (e.g., `Authorization`) for testing protected endpoints.
3. Send requests to the API and verify the responses.

### **Using cURL**
Example cURL command for testing an endpoint:
```bash
curl -X POST http://127.0.0.1:8000/api/register/ \
-H "Content-Type: application/json" \
-H "Authorization: Bearer <token>" \
-d '{
  "phone_number": "+911234567890",
  "name": "John Doe",
  "role": "EMPLOYEE",
  "password": "securepassword123"
}'
```

---

## üìñ Endpoints

### **1. Registration**

#### **Register a New User**
- **URL**: `/register/`
- **Method**: `POST`
- **Authentication**: Required (Bearer Token)
- **Description**: Allows the registration of new users. Superusers can register freely, while other roles have restrictions based on their hierarchy.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "phone_number": "+911234567890",
  "name": "John Doe",
  "role": "EMPLOYEE",
  "password": "securepassword123"
}
```

---

### **Request Body (Form Data)**

When sending data as `multipart/form-data` (useful for file uploads like profile photos), include the following fields:

| Key            | Value Type     | Description                                   |
|-----------------|---------------|-----------------------------------------------|
| `phone_number`  | String         | User's phone number in the format `+91XXXXXXXXXX`. |
| `name`          | String         | User's full name.                            |
| `role`          | String         | Role of the user (e.g., "EMPLOYEE").         |
| `password`      | String         | User‚Äôs password.                             |
| `profile_photo` | File (optional)| Profile photo of the user (image file).      |

Example in **Postman**:
1. Select `form-data` in the body.
2. Add the fields mentioned above.
3. Upload a file for the `profile_photo` field.

---

### **Response on Success**
- **Status**: `201 Created`

```json
{
  "success": true,
  "message": "User registered successfully!",
  "data": {
    "id": 1,
    "phone_number": "+911234567890",
    "name": "John Doe",
    "role": "EMPLOYEE",
    "profile_photo": null
  }
}
```

---

### **Response on Validation Error**
- **Status**: `400 Bad Request`

```json
{
  "success": false,
  "errors": {
    "phone_number": ["Phone number must be in the format +911234567890."]
  }
}
```

---

### **Response on Role Restriction Error**
- **Status**: `403 Forbidden`

```json
{
  "success": false,
  "errors": {
    "role": ["You are not allowed to create this role."]
  }
}
```

---

### **Response on Integrity Error**
- **Status**: `400 Bad Request`

```json
{
  "success": false,
  "errors": {
    "phone_number": ["Phone number must be unique."]
  }
}
```
### **2. Login**

#### **User Login**
- **URL**: `/login/`
- **Method**: `POST`
- **Authentication**: Not Required
- **Description**: Allows users to log in using their phone number and password. Employees are restricted from logging in.

##### **Headers**
```json
{
  "Content-Type": "application/json"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "phone_number": "+911234567890",
  "password": "securepassword123"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "access": "eyJ0eXAiOiJKV1QiLCJh...<truncated>",
  "role": "ADMIN"
}
```

---

### **Response on Forbidden Access (Employee Login)**
- **Status**: `403 Forbidden`

```json
{
  "error": "Employees are not allowed to log in."
}
```

---

### **Response on Invalid Credentials**
- **Status**: `401 Unauthorized`

```json
{
  "error": "Invalid Credentials"
}
```

---

### **3. Reset Password Workflow**

#### **3.1 Request Password Reset OTP**
- **URL**: `/request-reset-otp/`
- **Method**: `POST`
- **Authentication**: Not Required
- **Description**: Sends a password reset OTP to the user's registered phone number.

##### **Headers**
```json
{
  "Content-Type": "application/json"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "phone_number": "+911234567890"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "message": "OTP sent to your phone."
}
```

---

### **Response on Missing Phone Number**
- **Status**: `400 Bad Request`

```json
{
  "error": "Phone number is required."
}
```

---

### **Response on Non-Existent User**
- **Status**: `404 Not Found`

```json
{
  "error": "User with this phone number does not exist."
}
```

---

#### **3.2 Verify Password Reset OTP**
- **URL**: `/verify-reset-otp/`
- **Method**: `POST`
- **Authentication**: Not Required
- **Description**: Verifies the password reset OTP sent to the user.

##### **Headers**
```json
{
  "Content-Type": "application/json"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "phone_number": "+911234567890",
  "otp": "123456"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "message": "OTP verified. You can now reset your password."
}
```

---

### **Response on Missing Data**
- **Status**: `400 Bad Request`

```json
{
  "error": "Phone number and OTP are required."
}
```

---

### **Response on Invalid OTP**
- **Status**: `400 Bad Request`

```json
{
  "error": "Invalid OTP."
}
```

---

### **Response on Expired OTP**
- **Status**: `400 Bad Request`

```json
{
  "error": "OTP expired."
}
```

---

### **Response on Already Used OTP**
- **Status**: `400 Bad Request`

```json
{
  "error": "OTP already used."
}
```

---

#### **3.3 Reset Password**
- **URL**: `/reset-password/`
- **Method**: `POST`
- **Authentication**: Not Required
- **Description**: Resets the user's password after OTP verification.

##### **Headers**
```json
{
  "Content-Type": "application/json"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "phone_number": "+911234567890",
  "new_password": "newsecurepassword123"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "message": "Password reset successful."
}
```

---

### **Response on Missing Data**
- **Status**: `400 Bad Request`

```json
{
  "error": "Phone number and new password are required."
}
```

---

### **Response on Missing OTP Verification**
- **Status**: `400 Bad Request`

```json
{
  "error": "OTP verification required."
}
```

---

### **Response on Non-Existent User**
- **Status**: `404 Not Found`

```json
{
  "error": "User not found."
}
```

---

### **4. User Info**

#### **4.1 Get User Information**
- **URL**: `/user-info/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Fetches the authenticated user's information.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "phone_number": "+911234567890",
  "name": "John Doe",
  "role": "ADMIN",
  "profile_photo": "http://example.com/media/profile_photos/user.jpg"
}
```

---

#### **4.2 Update User Information**
- **URL**: `/user-info/`
- **Method**: `PUT`
- **Authentication**: Required (Bearer Token)
- **Description**: Updates the authenticated user's information. Only `name` and `profile_photo` can be updated. `phone_number` and `role` are read-only.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Request Body (JSON Format)**

```json
{
  "name": "John Updated"
}
```

---

### **Request Body (Form Data)**

When updating the profile photo, use `multipart/form-data`. Include:

| Key             | Value Type     | Description                              |
|------------------|---------------|------------------------------------------|
| `name`          | String         | User's updated name.                     |
| `profile_photo` | File (optional)| User's updated profile photo (image).    |

**Example in Form Data:**
- `name`: "John Updated"
- `profile_photo`: [Upload File]

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "phone_number": "+911234567890",
  "name": "John Updated",
  "role": "ADMIN",
  "profile_photo": "http://example.com/media/profile_photos/user_updated.jpg"
}
```

---

### **Response on Invalid Data**
- **Status**: `400 Bad Request`

```json
{
  "profile_photo": ["Invalid image format."]
}
```

---

### **5. Users List**

#### **5.1 Get Users List**
- **URL**: `/users/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Retrieves a list of users based on the role of the authenticated user.

##### **Role-Based Access Control**:
- **SUPERUSER**: Can view all users.
- **ADMIN**: Can view users with roles `MANAGER` and `EMPLOYEE`.
- **MANAGER**: Can view users with the role `EMPLOYEE`.
- **EMPLOYEE**: No access to this endpoint.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "phone_number": "+911234567890",
    "name": "John Doe",
    "role": "MANAGER",
    "profile_photo": "http://example.com/media/profile_photos/manager.jpg"
  },
  {
    "id": 2,
    "phone_number": "+911234567891",
    "name": "Jane Smith",
    "role": "EMPLOYEE",
    "profile_photo": "http://example.com/media/profile_photos/employee.jpg"
  }
]
```

---

### **Response on Forbidden Access**
If the user does not have permission to access this endpoint (e.g., an EMPLOYEE):
- **Status**: `403 Forbidden`

```json
{
  "detail": "You do not have permission to perform this action."
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **6. User List**

#### **6.1 Get Users List for Dropdowns/Messages**
- **URL**: `/users/list/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Retrieves a list of users excluding the currently logged-in user. The list is ordered by roles: `SUPERUSER` first, followed by `ADMIN`, and then `MANAGER`.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "phone_number": "+911234567890",
    "name": "Super User",
    "role": "SUPERUSER",
    "profile_photo": "http://example.com/media/profile_photos/superuser.jpg"
  },
  {
    "id": 2,
    "phone_number": "+911234567891",
    "name": "Admin User",
    "role": "ADMIN",
    "profile_photo": "http://example.com/media/profile_photos/admin.jpg"
  },
  {
    "id": 3,
    "phone_number": "+911234567892",
    "name": "Manager User",
    "role": "MANAGER",
    "profile_photo": "http://example.com/media/profile_photos/manager.jpg"
  }
]
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **7. Role-Based User List**

#### **7.1 Get Users by Role**
- **URL**: `/users/role/<str:role>/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Retrieves a list of users filtered by the specified role. Access is controlled based on the role of the authenticated user.

##### **Role-Based Access Control**:
- **SUPERUSER**: Can view all users for any role.
- **ADMIN**: Can view users with roles `MANAGER` and `EMPLOYEE`.
- **MANAGER**: Can view users with the role `EMPLOYEE`.
- **EMPLOYEE**: No access to this endpoint.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Path Parameter**

| Parameter | Type   | Description                                      |
|-----------|--------|--------------------------------------------------|
| `role`    | String | The role of users to filter (e.g., `SUPERUSER`, `ADMIN`, `MANAGER`, `EMPLOYEE`). |

---

### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "phone_number": "+911234567890",
    "name": "John Doe",
    "role": "MANAGER",
    "profile_photo": "http://example.com/media/profile_photos/manager.jpg"
  },
  {
    "id": 2,
    "phone_number": "+911234567891",
    "name": "Jane Smith",
    "role": "MANAGER",
    "profile_photo": "http://example.com/media/profile_photos/manager2.jpg"
  }
]
```

---

### **Response on No Users Found or Access Denied**
- **Status**: `404 Not Found`

```json
{
  "message": "No users found or access denied."
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **8. User Update**

#### **8.1 Retrieve or Update User Details**
- **URL**: `/users/update/<int:id>/`
- **Method**: `GET`, `PUT`, `PATCH`
- **Authentication**: Required (Bearer Token)
- **Description**: Allows retrieving or updating user details based on the authenticated user's role. Role-based restrictions apply for updates.

##### **Role-Based Access Control**:
- **SUPERUSER**: Can retrieve and update all users.
- **ADMIN**: Can retrieve and update `ADMIN`, `MANAGER`, and `EMPLOYEE` users but not `SUPERUSER`.
- **MANAGER**: Can retrieve and update their own details and `EMPLOYEE` details but cannot change roles.
- **EMPLOYEE**: Can only retrieve and update their own details.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **GET: Retrieve User Details**

#### **Response on Success**
- **Status**: `200 OK`

```json
{
  "id": 5,
  "phone_number": "+911234567890",
  "name": "John Doe",
  "role": "EMPLOYEE",
  "profile_photo": "http://example.com/media/profile_photos/employee.jpg"
}
```

---

### **PUT/PATCH: Update User Details**

#### **Request Body (JSON Format)**

```json
{
  "name": "Updated Name",
  "profile_photo": "http://example.com/media/profile_photos/new_profile.jpg",
  "role": "MANAGER"  // Optional for SUPERUSER/ADMIN
}
```

#### **Request Body (Form Data)**

When updating the profile photo, use `multipart/form-data`. Include:

| Key             | Value Type     | Description                              |
|------------------|---------------|------------------------------------------|
| `name`          | String         | User's updated name.                     |
| `profile_photo` | File (optional)| User's updated profile photo (image).    |
| `role`          | String         | Optional for role changes by `SUPERUSER` or `ADMIN`. |

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "id": 5,
  "phone_number": "+911234567890",
  "name": "Updated Name",
  "role": "MANAGER",
  "profile_photo": "http://example.com/media/profile_photos/new_profile.jpg"
}
```

---

### **Response on Forbidden Role Update**
- **Status**: `403 Forbidden`

```json
{
  "error": "You do not have permission to edit this user."
}
```

---

### **Response on Unauthorized Role Change**
- **Status**: `403 Forbidden`

```json
{
  "error": "You do not have permission to change roles."
}
```

---

### **Response on Attempt to Change SUPERUSER Role**
- **Status**: `403 Forbidden`

```json
{
  "error": "The role of a SUPERUSER cannot be changed."
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---
### **9. User Detail**

#### **9.1 Retrieve or Delete a User**
- **URL**: `/users/<int:id>/`
- **Method**: `GET`, `DELETE`
- **Authentication**: Required (Bearer Token)
- **Description**: Allows retrieving or deleting a specific user based on the authenticated user's role. Role-based restrictions apply for both operations.

##### **Role-Based Access Control**:
- **SUPERUSER**: Can retrieve or delete any user.
- **ADMIN**: Can retrieve or delete `MANAGER` and `EMPLOYEE` users but not `SUPERUSER`.
- **MANAGER**: Can retrieve or delete `EMPLOYEE` users only.
- **EMPLOYEE**: No access to this endpoint.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **GET: Retrieve User Details**

#### **Response on Success**
- **Status**: `200 OK`

```json
{
  "id": 5,
  "phone_number": "+911234567890",
  "name": "John Doe",
  "role": "EMPLOYEE",
  "profile_photo": "http://example.com/media/profile_photos/employee.jpg"
}
```

---

### **Response on Forbidden Access**
- **Status**: `403 Forbidden`

```json
{
  "error": "You do not have permission to view this user."
}
```

---

### **DELETE: Delete a User**

#### **Response on Success**
- **Status**: `200 OK`

```json
{
  "message": "User deleted successfully."
}
```

---

### **Response on Forbidden Deletion**
- **Status**: `403 Forbidden`

```json
{
  "error": "You do not have permission to delete this user."
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **10. User Count**

#### **10.1 Get User Counts by Role**
- **URL**: `/users/count/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Retrieves the count of users by role. Role-based restrictions apply to determine which roles the authenticated user can view.

##### **Role-Based Access Control**:
- **SUPERUSER**: Can view counts for all roles (`SUPERUSER`, `ADMIN`, `MANAGER`, `EMPLOYEE`).
- **ADMIN**: Can view counts for `MANAGER` and `EMPLOYEE` roles.
- **MANAGER**: Can view the count for `EMPLOYEE` role.
- **EMPLOYEE**: No access to this endpoint.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Query Parameters**

| Parameter | Type   | Description                                      |
|-----------|--------|--------------------------------------------------|
| `role`    | String | (Optional) Specify a role to filter the count (e.g., `SUPERUSER`, `ADMIN`, `MANAGER`, `EMPLOYEE`). |

---

### **Response on Success (Specific Role)**
If the `role` query parameter is provided:
- **Status**: `200 OK`

```json
{
  "MANAGER": 5
}
```

---

### **Response on Success (All Allowed Roles)**
If no `role` query parameter is provided:
- **Status**: `200 OK`

```json
[
  {
    "role": "MANAGER",
    "count": 5
  },
  {
    "role": "EMPLOYEE",
    "count": 15
  }
]
```

---

### **Response on Forbidden Access**
If the user does not have permission to view the count for the specified role:
- **Status**: `403 Forbidden`

```json
{
  "error": "You do not have permission to view this count."
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---
### **11. Employee Management**

#### **11.1 Employee View**
- **URL**: `/employees/`
- **Method**: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
- **Authentication**: Required (Bearer Token)
- **Description**: Provides CRUD operations for managing employees. Only users with valid authentication can access this endpoint.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **GET: Retrieve Employee List**
Retrieves a list of all employees. Employees are filtered by the `EMPLOYEE` role and ordered by their IDs in descending order.

#### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "user": {
      "id": 5,
      "phone_number": "+911234567890",
      "name": "John Employee",
      "role": "EMPLOYEE",
      "profile_photo": "http://example.com/media/profile_photos/employee.jpg"
    },
    "is_available": true
  },
  {
    "id": 2,
    "user": {
      "id": 6,
      "phone_number": "+911234567891",
      "name": "Jane Employee",
      "role": "EMPLOYEE",
      "profile_photo": "http://example.com/media/profile_photos/employee2.jpg"
    },
    "is_available": false
  }
]
```

---

### **POST: Create a New Employee**
Allows the creation of a new employee.

#### **Request Body (JSON Format)**

```json
{
  "user": {
    "phone_number": "+911234567892",
    "name": "New Employee",
    "role": "EMPLOYEE",
    "profile_photo": "http://example.com/media/profile_photos/new_employee.jpg"
  },
  "is_available": true
}
```

#### **Response on Success**
- **Status**: `201 Created`

```json
{
  "id": 3,
  "user": {
    "id": 7,
    "phone_number": "+911234567892",
    "name": "New Employee",
    "role": "EMPLOYEE",
    "profile_photo": "http://example.com/media/profile_photos/new_employee.jpg"
  },
  "is_available": true
}
```

---

### **PUT/PATCH: Update an Employee**
Allows updating employee details.

#### **Request Body (JSON Format)**

```json
{
  "is_available": false
}
```

#### **Response on Success**
- **Status**: `200 OK`

```json
{
  "id": 3,
  "user": {
    "id": 7,
    "phone_number": "+911234567892",
    "name": "New Employee",
    "role": "EMPLOYEE",
    "profile_photo": "http://example.com/media/profile_photos/new_employee.jpg"
  },
  "is_available": false
}
```

---

### **DELETE: Delete an Employee**
Allows deleting an employee record.

#### **Response on Success**
- **Status**: `204 No Content`

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **12. Available Employees**

#### **12.1 Get Available Employees**
- **URL**: `/available-employees/`
- **Method**: `GET`
- **Authentication**: Required (Bearer Token)
- **Description**: Retrieves a list of available employees for a specific booking, excluding those who are busy during the requested time range.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **Query Parameters**

| Parameter     | Type   | Description                           |
|---------------|--------|---------------------------------------|
| `booking_id`  | Integer| **Required**. The ID of the booking to check for employee availability. |

---

### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "user": {
      "id": 5,
      "phone_number": "+911234567890",
      "name": "John Employee",
      "role": "EMPLOYEE",
      "profile_photo": "http://example.com/media/profile_photos/employee.jpg"
    },
    "is_available": true
  },
  {
    "id": 2,
    "user": {
      "id": 6,
      "phone_number": "+911234567891",
      "name": "Jane Employee",
      "role": "EMPLOYEE",
      "profile_photo": "http://example.com/media/profile_photos/employee2.jpg"
    },
    "is_available": true
  }
]
```

---

### **Response on Missing Booking ID**
- **Status**: `400 Bad Request`

```json
{
  "detail": "Booking ID is required"
}
```

---

### **Response on Non-Existent Booking**
- **Status**: `400 Bad Request`

```json
{
  "detail": "Booking not found"
}
```

---

### **Response on Unauthorized Access**
If the request is made without a valid token:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **13. Booking Management**

#### **13.1 Booking Flow (Admin Panel)**
The following steps outline the flow for creating or managing bookings from the **Admin Panel**:

1. **Create a Booking**
   - Navigate to the Admin Panel.
   - Fill in the required booking details:
     - **Full Name**: The client's name.
     - **Email**: The client's email address.
     - **Phone Number**: Must be in the format `+91XXXXXXXXXX` (13 digits).
     - **Address**: The service address.
     - **Service Name**: The name of the service (e.g., "General Pest Control").
     - **Booking Date and Time**: Specify when the service is requested.
     - **Price**: Enter the base price for the service.
   - Submit the form. The system will:
     - Automatically calculate **GST**, **Payment Gateway Charges**, and the **Grand Total**.
     - Set the booking **status** based on the service and price.
     - Validate mandatory fields (e.g., `Plan`, `Property Type`, etc., for specific services).

2. **View Bookings**
   - Access the list of all bookings in the Admin Panel.
   - Filter bookings by:
     - Status (`Pending`, `Inspection Assigned`, etc.)
     - Date Range
     - Client Name or Phone Number
   - Click on a booking to view its details.

3. **Update Booking**
   - Open a specific booking.
   - Modify fields such as:
     - **Status**: Update to `Inspection Assigned`, `Work Assigned`, or `Service Completed` based on progress.
     - **Price**: Adjust the price if required.
   - Submit changes. The system will:
     - Update the **Grand Total** automatically.
     - Mark employees as available if the status changes to `Service Completed`.

4. **Delete Booking**
   - Select a booking to delete.
   - Confirm the deletion. This action is restricted to `Superuser`, `Admin`, or `Manager` roles.

5. **Generate Payment Link**
   - Open a booking.
   - Enter the price and click "Generate Payment Link".
   - The system will:
     - Calculate the **Grand Total**.
     - Generate a secure payment link using the booking's `Secure Token`.
     - Send the link to the client's registered phone number via SMS.

6. **View Service History**
   - Open a booking.
   - View the list of employees assigned to the booking and their service timelines.

7. **Reports and Analytics**
   - Access reports to view:
     - Total bookings by status.
     - Revenue generated.
     - Employee performance metrics.

---

#### **13.2 Booking View**

- **URL**: `/bookings/`
- **Method**: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
- **Authentication**: Required (Bearer Token)
- **Description**: Provides CRUD operations for managing bookings. Includes additional actions for service history and payment link generation.

##### **Headers**
```json
{
  "Authorization": "Bearer <token>"
}
```

---

### **GET: Retrieve All Bookings**
Retrieves a list of all bookings, ordered by their IDs in descending order.

#### **Response on Success**
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "full_name": "John Doe",
    "email": "john.doe@example.com",
    "phone_number": "+911234567890",
    "address": "123 Main St, City",
    "service_name": "General Pest Control",
    "booking_date": "2025-05-01",
    "booking_time": "10:00:00",
    "price": 5000.00,
    "gst": 900.00,
    "payment_gateway_charges": 130.00,
    "grand_total": 6030.00,
    "payment_status": false,
    "status": "PENDING",
    "secure_token": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
    "created_at": "2025-05-01T10:00:00Z"
  }
]
```

---

### **POST: Create a New Booking**
Allows the creation of a new booking.

#### **Request Body (JSON Format)**

```json
{
  "full_name": "Jane Smith",
  "email": "jane.smith@example.com",
  "phone_number": "+911234567891",
  "address": "456 Elm St, City",
  "service_name": "Honey Bees Control",
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 12000
}
```

#### **Response on Success**
- **Status**: `201 Created`

```json
{
  "id": 2,
  "full_name": "Jane Smith",
  "email": "jane.smith@example.com",
  "phone_number": "+911234567891",
  "address": "456 Elm St, City",
  "service_name": "Honey Bees Control",
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 12000.00,
  "gst": 2160.00,
  "payment_gateway_charges": 312.00,
  "grand_total": 14472.00,
  "payment_status": false,
  "status": "PENDING",
  "secure_token": "d290f1ee-6c54-4b01-90e6-d701748f0851",
  "created_at": "2025-05-06T06:37:15Z"
}
```

#### **Response on Validation Error**
- **Status**: `400 Bad Request`

```json
{
  "error": "An error occurred while creating the booking",
  "details": {
    "phone_number": ["Phone number must be in format +91XXXXXXXXXX (13 digits)."]
  }
}
```

---

### **PUT/PATCH: Update a Booking**
Allows updating all fields of an existing booking. Restricted to `SUPERUSER`, `ADMIN`, and `MANAGER`.

#### **Request Body (JSON Format)**

```json
{
  "status": "SERVICE_COMPLETED",
  "price": 15000
}
```

#### **Response on Success**
- **Status**: `200 OK`

```json
{
  "id": 2,
  "full_name": "Jane Smith",
  "email": "jane.smith@example.com",
  "phone_number": "+911234567891",
  "address": "456 Elm St, City",
  "service_name": "Honey Bees Control",
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 15000.00,
  "gst": 2700.00,
  "payment_gateway_charges": 390.00,
  "grand_total": 18090.00,
  "payment_status": false,
  "status": "SERVICE_COMPLETED",
  "secure_token": "d290f1ee-6c54-4b01-90e6-d701748f0851",
  "created_at": "2025-05-06T06:37:15Z"
}
```

---

### **DELETE: Delete a Booking**
Allows deletion of a booking. Restricted to `SUPERUSER`, `ADMIN`, and `MANAGER`.

#### **Response on Success**
- **Status**: `204 No Content`

---

### **Additional Actions**

#### **13.2 Service History**
- **URL**: `/bookings/{id}/service_history/`
- **Method**: `GET`
- **Description**: Retrieves the service history for a specific booking.

---

#### **13.3 Generate Payment Link**
- **URL**: `/bookings/{id}/generate_payment_link/`
- **Method**: `POST`
- **Description**: Generates a payment link for a specific booking and sends it to the client's phone number.

---

### **Response on Unauthorized Access**
- **Status**: `403 Forbidden`

```json
{
  "error": "Unauthorized",
  "message": "You don't have permission to perform this action."
}
```

---

### **14. Booking Flow for Website (Frontend Integration)**

#### **14.1 Save Booking (API Binding with HTML/JS)**
This API route is used by the website to handle booking submissions via JavaScript and HTML forms. The route processes booking details, calculates GST and other charges, saves the booking to the database, and sends the response back to the frontend.

---

### **Route Details**

#### **URL**: `/save_booking/`
#### **Method**: `POST`
#### **Authentication**: Not required for website users.
#### **Description**: Handles booking submissions from the website's frontend. The same flow is used for booking offers by reusing the booking details.

---

### **Frontend Binding**

The booking form is integrated in the `booking_form.html` file with JavaScript API calls to the `/save_booking/` endpoint. 
- The form collects the following details:
  - Personal Information: Full name, email, phone number.
  - Address Information: Address, latitude, longitude, zipcode.
  - Service Details: Service name, plan, property type, house condition, location.
  - Booking Date and Time.
  - Price and Offer Name.

---

### **Request Body (JSON Format)**

```json
{
  "full_name": "John Doe",
  "email": "john.doe@example.com",
  "phone_number": "+911234567890",
  "address": "123 Main St, City",
  "latitude": 19.0330,
  "longitude": 73.0297,
  "zipcode": "400001",
  "service_name": "General Pest Control",
  "plan": "Annual Package 03 Services",
  "property_type": "Residential",
  "house_condition": "Good",
  "location": "Mumbai",
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 12000,
  "offer_name": "Summer Discount"
}
```

---

### **Backend Workflow**

1. **Price Handling**:
   - If the price is `"As per condition"`, it defaults to `0`.
   - Otherwise, it is converted to a float.

2. **Charge Calculations**:
   - **GST (18%)**: `price * 0.18`
   - **Payment Gateway Charges (2.6%)**: `price * 0.026`
   - **Grand Total**: `price + gst + payment_gateway_charges`

3. **Save Booking**:
   - A new `Booking` object is created and saved with the provided details.

4. **Optional Notifications**:
   - **Thank You SMS**: Sent to the user's phone number (currently commented out).
   - **Booking Details to Owner**: Sent to the admin or owner (currently commented out).

5. **Return Response**:
   - Returns the booking details including calculated charges back to the frontend.

---

### **Response on Success**
- **Status**: `201 Created`

```json
{
  "message": "Booking saved successfully!",
  "booking_id": 1,
  "full_name": "John Doe",
  "email": "john.doe@example.com",
  "phone_number": "+911234567890",
  "address": "123 Main St, City",
  "latitude": 19.0330,
  "longitude": 73.0297,
  "zipcode": "400001",
  "service_name": "General Pest Control",
  "plan": "Annual Package 03 Services",
  "property_type": "Residential",
  "house_condition": "Good",
  "location": "Mumbai",
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 12000,
  "offer_name": "Summer Discount",
  "gst": 2160.00,
  "payment_gateway_charges": 312.00,
  "grand_total": 14472.00
}
```

---

### **Response on Invalid Request**
- **Status**: `400 Bad Request`

```json
{
  "error": "Invalid request"
}
```

---

### **14.2 Notes on Offer Integration**

- **Shared Flow**: The offer booking follows the **same flow** as the regular booking. It uses the same `/save_booking/` route and passes the offer details in the `offer_name` field.
- **Offer Validation**: 
  - The system checks if the `offer_name` exists and is active.
  - If invalid, the `offer_applied` field defaults to `false` and the required fields (e.g., `plan`, `property_type`, etc.) are validated.

---



---

### **Frontend File Reference**
- **Filename**: `booking_form.html`
- **Purpose**: Contains the HTML and JavaScript code for the booking form and API integration.

---
### **15. Get Booking Details**

#### **15.1 Fetch Booking Details by ID**
This endpoint retrieves the details of a booking based on its unique `booking_id`. It calculates GST, Payment Gateway Charges, and Grand Total dynamically before returning the data.

---

### **Route Details**

#### **URL**: `/get-booking-details/<int:booking_id>/`
#### **Method**: `GET`
#### **Authentication**: Not required.
#### **Description**: Fetches booking details from the database using the provided `booking_id`.

---

### **Details of API Workflow**

1. **Fetch Booking**:
   - Uses the `booking_id` to retrieve the booking from the database using `get_object_or_404`.
   - If the booking does not exist, a 404 error is returned.

2. **Calculate Charges**:
   - **GST (18%)**: `price * 0.18`
   - **Payment Gateway Charges (2.6%)**: `price * 0.026`
   - **Grand Total**: Sum of `price`, `GST`, and `Payment Gateway Charges`.

3. **Return Data**:
   - Converts the `Decimal` values for price and charges into `float` for JSON compatibility.
   - Returns all booking details and calculated values in the response.

---

### **Request Example**

#### **GET**
```
/get-booking-details/1/
```

---

### **Response on Success**
- **Status**: `200 OK`

```json
{
  "booking_id": 1,
  "full_name": "John Doe",
  "email": "john.doe@example.com",
  "phone_number": "+911234567890",
  "address": "123 Main St, City",
  "latitude": 19.033,
  "longitude": 73.0297,
  "zipcode": "400001",
  "service_name": "General Pest Control",
  "plan": "Annual Package 03 Services",
  "property_type": "Residential",
  "house_condition": "Good",
  "location": "Mumbai",
  "Payment_Status": false,
  "booking_date": "2025-05-10",
  "booking_time": "14:00:00",
  "price": 12000.00,
  "gst": 2160.00,
  "payment_gateway_charges": 312.00,
  "grand_total": 14472.00
}
```

---

### **Response on Booking Not Found**
- **Status**: `404 Not Found`

```json
{
  "detail": "Not Found"
}
```

---

### **Notes**
- This endpoint is useful for both admin panels and website integrations where detailed booking information is required.
- Calculations for GST and Payment Gateway Charges ensure that the latest values are always returned with the booking details.


### **16. Offer Management (Admin Panel)**

#### **16.1 Offer View**
This endpoint provides CRUD operations for managing offers, including creating, updating, and deleting offers. The status and discount price of offers are automatically calculated based on the provided data.

---

### **Route Details**

#### **URL**: `/offers/`
#### **Method**: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
#### **Authentication**: 
- **Required for Create, Update, and Delete**: Only accessible by `Superuser`, `Admin`, or `Manager`.
- **Optional for Read**: Any user can view the offers.

#### **Description**: 
- For creating and managing offers through the Admin Panel.
- Automatically calculates `discount_price` and updates the `status` (`ACTIVE` or `EXPIRED`) based on the provided `end_date`.

---

### **Endpoints and Methods**

#### **Endpoint**: `/offers/`
- **GET**: List all offers.
- **POST**: Create a new offer.

#### **Endpoint**: `/offers/<id>/`
- **GET**: Retrieve a specific offer by ID.
- **PUT/PATCH**: Update an existing offer.
- **DELETE**: Delete an offer (and its associated image file).

---

### **Request Body (Create and Update)**

#### **Create Offer (POST)**:
```json
{
  "title": "Summer Discount",
  "description": "Get 20% off on all pest control services.",
  "price": 1000,
  "discount": 20,
  "start_date": "2025-05-01",
  "end_date": "2025-05-31",
  "service_name": ["General Pest Control", "Bed Bugs Control"],
  "offer_banner": "<file>"
}
```

#### **Update Offer (PUT/PATCH)**:
```json
{
  "title": "Updated Summer Discount",
  "description": "Get 25% off on all pest control services.",
  "discount": 25,
  "end_date": "2025-06-15",
  "service_name": ["General Pest Control", "Anti Termite Treatment"]
}
```

---

### **Response Examples**

#### **Response on Success (Create or Update)**:
- **Status**: `201 Created` (for POST), `200 OK` (for PUT/PATCH)

```json
{
  "id": 1,
  "title": "Summer Discount",
  "description": "Get 20% off on all pest control services.",
  "price": 1000,
  "discount": 20,
  "discount_price": 800.0,
  "start_date": "2025-05-01",
  "end_date": "2025-05-31",
  "status": "ACTIVE",
  "services": ["General Pest Control", "Bed Bugs Control"],
  "offer_banner": "http://example.com/media/offers/summer_discount.jpg"
}
```

#### **Response on Offer Deletion**:
- **Status**: `204 No Content`

```json
{
  "message": "Offer and associated image deleted successfully."
}
```

#### **Response on Validation Error**:
- **Status**: `400 Bad Request`

```json
{
  "error": "Validation failed",
  "message": {
    "discount": ["Ensure this value is less than or equal to 100."]
  }
}
```

#### **Response on Unauthorized Access**:
- **Status**: `403 Forbidden`

```json
{
  "error": "Unauthorized",
  "message": "You do not have permission to perform this action."
}
```

---

### **16.2 Backend Workflow**

#### **1. Offer Creation**:
- **Discount Price Calculation**: `price - (price * discount / 100)`
- **Status Calculation**:
  - `ACTIVE` if `end_date` is in the future.
  - `EXPIRED` if `end_date` has passed.
- **Services**: Maps `service_name` to the `services` field.

#### **2. Offer Update**:
- Recalculates `discount_price` and `status` when updated.
- Deletes the old image file if a new image is uploaded.

#### **3. Offer Deletion**:
- Deletes the offer and its associated banner image file (if exists).

---

### **16.3 Permissions**

| Action                | Roles Allowed              |
|-----------------------|----------------------------|
| **Create**            | `Superuser`, `Admin`, `Manager` |
| **Update**            | `Superuser`, `Admin`, `Manager` |
| **Delete**            | `Superuser`, `Admin`, `Manager` |
| **Read**              | All users                 |

---

### **16.4 Notes**

- **Image Handling**:
  - Old images are deleted when a new image is uploaded during an update.
  - Attempting to delete the image file during offer deletion is optional (logs warnings if it fails).

- **Service Choices**:
  - The `service_name` field accepts a list of predefined service choices available in `Offer.SERVICE_CHOICES`.


### **17. Razorpay Payment Integration**

#### **17.1 Overview**
These endpoints handle Razorpay payment integration and are directly connected to the booking form on the website. They allow the creation of Razorpay payment orders and verification of payments after the user completes the transaction.

---

### **Endpoints**

#### **1. Create Razorpay Order**
- **URL**: `/create-order/<int:booking_id>/`
- **Method**: `POST`
- **Authentication**: Not required.
- **Description**: Creates a Razorpay payment order for the specified booking. If an existing order for the booking is pending, it will return the existing order instead of creating a new one.

---

#### **2. Verify Payment**
- **URL**: `/verify-payment/`
- **Method**: `POST`
- **Authentication**: Not required.
- **Description**: Verifies the payment response from Razorpay and updates the payment and booking status accordingly.

---

### **Detailed Workflow**

#### **17.2 Create Razorpay Order**

1. **Request**:
   - The `booking_id` is passed in the URL.
   - The endpoint checks if a pending payment order already exists for the booking.
   - If an existing order is found:
     - Returns the existing Razorpay order details.
   - If no existing order:
     - Creates a new Razorpay order using the Razorpay API.
     - Saves the order details in the `Payment` model.

2. **Response on Success (Existing Order)**:
   - **Status**: `200 OK`

```json
{
  "order_id": "order_123abc456",
  "amount": 14472.00,
  "key": "rzp_test_abc123xyz",
  "message": "Using existing order"
}
```

3. **Response on Success (New Order)**:
   - **Status**: `201 Created`

```json
{
  "order_id": "order_789xyz123",
  "amount": 14472.00,
  "key": "rzp_test_abc123xyz",
  "message": "New order created"
}
```

4. **Response on Error**:
   - **Status**: `500 Internal Server Error`

```json
{
  "error": "Error message describing the issue"
}
```

---

#### **17.3 Verify Payment**

1. **Request**:
   - The payment details are sent in the request body:
     - `razorpay_order_id`: The Razorpay order ID.
     - `razorpay_payment_id`: The Razorpay payment ID.
     - `razorpay_signature`: The payment signature for verification.

2. **Workflow**:
   - Fetches the `Payment` object using the `razorpay_order_id`.
   - Verifies the payment signature using the Razorpay SDK.
   - If verification succeeds:
     - Updates the `Payment` status to `SUCCESS`.
     - Marks the associated booking's `payment_status` as `True`.
     - Sends a payment success SMS to the client.
     - Allows access to the "Thank You" page by setting a session flag.
   - If verification fails:
     - Updates the `Payment` status to `FAILED`.

3. **Response on Payment Success**:
   - **Status**: `200 OK`

```json
{
  "message": "Payment successful",
  "status": "SUCCESS"
}
```

4. **Response on Payment Verification Failure**:
   - **Status**: `400 Bad Request`

```json
{
  "message": "Payment verification failed",
  "status": "FAILED"
}
```

5. **Response on Invalid Order ID**:
   - **Status**: `400 Bad Request`

```json
{
  "message": "Invalid order ID"
}
```

6. **Response on Invalid Request**:
   - **Status**: `400 Bad Request`

```json
{
  "error": "Invalid request"
}
```

---

### **17.4 Notes**

- **API Key**: The Razorpay API key is returned in the response to enable the frontend to initiate the Razorpay payment interface.
- **Amount Conversion**:
  - The amount is converted to paise (multiplied by 100) when creating the Razorpay order, as required by Razorpay.
- **Session Management**:
  - A session flag (`payment_verified`) is set after successful payment verification to allow access to the "Thank You" page.


### **18. Razorpay Payment Integration (From Payment Link)**

#### **18.1 Overview**
These endpoints manage Razorpay payment integration for clients using payment links (e.g., offers or booking payment links). They allow the creation of Razorpay payment orders and the verification of payments initiated via these links.

---

### **Endpoints**

#### **1. Generate Razorpay Payment Order**
- **URL**: `/create-payment-order-link/<int:booking_id>/`
- **Method**: `GET`
- **Authentication**: Not required.
- **Description**: Creates or retrieves a Razorpay payment order for the specified booking, ensuring the client can proceed with payment.

#### **2. Verify Razorpay Payment**
- **URL**: `/verify-payment-link/`
- **Method**: `POST`
- **Authentication**: Not required.
- **Description**: Verifies the Razorpay payment response and updates the payment and booking status accordingly.

---

### **Detailed Workflow**

#### **18.2 Generate Razorpay Payment Order**

1. **Request**:
   - The `booking_id` is passed in the URL.
   - The endpoint checks if a payment record already exists for the booking:
     - If it exists and includes a Razorpay order ID, the existing order is returned.
     - If it exists but no order ID is present, a new Razorpay order is created.

2. **Razorpay Order Creation**:
   - The `grand_total` of the booking is converted to paise (multiplied by 100) since Razorpay operates in paise.
   - A new Razorpay order is created using the Razorpay API and the details are saved in the `Payment` model.

3. **Response on Success**:
   - **Status**: `200 OK`

```json
{
  "success": true,
  "key": "rzp_test_abc123xyz",
  "amount": 1447200,
  "currency": "INR",
  "name": "Your Company Name",
  "description": "Payment for Booking 1",
  "order_id": "order_123abc456"
}
```

4. **Response on Booking Not Found**:
   - **Status**: `404 Not Found`

```json
{
  "success": false,
  "error": "Booking not found"
}
```

5. **Response on Other Errors**:
   - **Status**: `500 Internal Server Error`

```json
{
  "success": false,
  "error": "Error message describing the issue"
}
```

---

#### **18.3 Verify Razorpay Payment**

1. **Request**:
   - The payment details are included in the request body:
     - `razorpay_order_id`: The Razorpay order ID.
     - `razorpay_payment_id`: The Razorpay payment ID.
     - `razorpay_signature`: The payment signature for verification.
     - `booking_id`: The associated booking ID.

2. **Workflow**:
   - Fetches the `Payment` object using the `razorpay_order_id`.
   - Verifies the payment signature using the Razorpay SDK.
   - If verification succeeds:
     - Updates the `Payment` status to `SUCCESS`.
     - Marks the associated booking's `payment_status` as `True`.
     - Updates the booking's `status` to `INSPECTION_ASSIGNED`.
     - Sends a payment success SMS to the client.
   - If verification fails:
     - Updates the `Payment` status to `FAILED`.

3. **Response on Payment Success**:
   - **Status**: `200 OK`

```json
{
  "success": true
}
```

4. **Response on Payment Verification Failure**:
   - **Status**: `400 Bad Request`

```json
{
  "success": false,
  "message": "Signature verification failed"
}
```

5. **Response on Invalid Order ID**:
   - **Status**: `400 Bad Request`

```json
{
  "success": false,
  "message": "Invalid Order ID"
}
```

6. **Response on Invalid Request**:
   - **Status**: `400 Bad Request`

```json
{
  "success": false,
  "message": "Invalid request"
}
```

---

### **18.4 Notes**

- **API Key**: The Razorpay API key is returned in the response to enable the frontend to initiate the Razorpay payment interface.
- **Amount Conversion**:
  - The amount is converted to paise (multiplied by 100) when creating the Razorpay order, as required by Razorpay.
- **Booking Status Update**:
  - After successful payment verification, the associated booking's status is updated to `INSPECTION_ASSIGNED`.
- **Session Management**:
  - This flow is designed for clients accessing the payment link directly.

---

### **19. Transaction History**

#### **19.1 Overview**
This endpoint provides transaction history for payments made through the platform. Only users with roles `ADMIN`, `MANAGER`, or `SUPERUSER` are authorized to access this endpoint.

---

### **Endpoint Details**

#### **URL**: `/transactions/`
#### **Method**: `GET`
#### **Authentication**: Required (Bearer Token)
#### **Authorization**: 
- Accessible only to users with roles:
  - `ADMIN`
  - `MANAGER`
  - `SUPERUSER`
- Other roles (`EMPLOYEE`, `USER`, etc.) are not authorized.

#### **Description**: 
- Fetches all payment transactions, ordered by the most recent (`created_at` in descending order).
- Includes detailed information about the associated booking.

---

### **Response Fields**

| Field                | Type       | Description                              |
|----------------------|------------|------------------------------------------|
| `id`                 | Integer    | Unique ID of the payment record.         |
| `booking_id`         | Integer    | ID of the associated booking.            |
| `booking_info`       | Object     | Detailed information about the booking.  |
| `razorpay_order_id`  | String     | Razorpay order ID for the payment.       |
| `amount`             | Decimal    | Amount of the payment.                   |
| `status`             | String     | Status of the payment (`PENDING`, `SUCCESS`, `FAILED`). |
| `created_at`         | DateTime   | Timestamp of when the payment was created. |

---

### **Request Example**

#### **GET**:
```
/transactions/
```

---

### **Response Example**

#### **Success Response**:
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "booking_id": 101,
    "booking_info": {
      "full_name": "John Doe",
      "email": "john.doe@example.com",
      "phone_number": "+911234567890",
      "address": "123 Main St, City",
      "service_name": "General Pest Control",
      "price": 12000
    },
    "razorpay_order_id": "order_123abc456",
    "amount": 14472.00,
    "status": "SUCCESS",
    "created_at": "2025-05-01T10:00:00Z"
  },
  {
    "id": 2,
    "booking_id": 102,
    "booking_info": {
      "full_name": "Jane Smith",
      "email": "jane.smith@example.com",
      "phone_number": "+911234567891",
      "address": "456 Elm St, City",
      "service_name": "Honey Bees Control",
      "price": 15000
    },
    "razorpay_order_id": "order_789xyz123",
    "amount": 18090.00,
    "status": "PENDING",
    "created_at": "2025-05-02T14:00:00Z"
  }
]
```

#### **Forbidden Response**:
- **Status**: `403 Forbidden`

```json
{
  "detail": "Not authorized."
}
```

---

### **19.2 Notes**

- **Role-Based Access Control**:
  - Only `ADMIN`, `MANAGER`, and `SUPERUSER` roles can access transaction history.
  - Unauthorized roles will receive a `403 Forbidden` response.
  
- **Ordering**:
  - Transactions are ordered by the `created_at` field in descending order, with the latest transactions appearing first.

- **Booking Details**:
  - The `booking_info` field provides detailed information about the associated booking, including the client's name, contact details, and service information.

---

### **20. Retrieve Active Offers**

#### **20.1 Overview**
This endpoint retrieves all active offers from the database and returns them as JSON. It is used to display active offers on the website.

---

### **Endpoint Details**

#### **URL**: `/get_offers/`
#### **Method**: `GET`
#### **Authentication**: Not required.
#### **Authorization**: Open to all users.
#### **Description**: Fetches all offers with a status of `ACTIVE` (case-insensitive).

---

### **Response Fields**

| Field             | Type       | Description                              |
|-------------------|------------|------------------------------------------|
| `id`              | Integer    | Unique ID of the offer.                  |
| `title`           | String     | Title of the offer.                      |
| `description`     | String     | Detailed description of the offer.       |
| `price`           | Decimal    | Original price for the service.          |
| `discount`        | Decimal    | Discount percentage.                     |
| `discount_price`  | Decimal    | Price after applying the discount.       |
| `start_date`      | Date       | Offer start date.                        |
| `end_date`        | Date       | Offer end date.                          |
| `status`          | String     | Status of the offer (`ACTIVE` or `EXPIRED`). |
| `services`        | List       | List of services applicable to the offer. |
| `offer_banner`    | URL        | URL to the offer banner image.           |

---

### **Request Example**

#### **GET**:
```
/get_offers/
```

---

### **Response Examples**

#### **Success Response**:
- **Status**: `200 OK`

```json
[
  {
    "id": 1,
    "title": "Summer Discount",
    "description": "Get 20% off on all pest control services.",
    "price": 1000.00,
    "discount": 20.00,
    "discount_price": 800.00,
    "start_date": "2025-05-01",
    "end_date": "2025-05-31",
    "status": "ACTIVE",
    "services": ["General Pest Control", "Bed Bugs Control"],
    "offer_banner": "http://example.com/media/offers/summer_discount.jpg"
  },
  {
    "id": 2,
    "title": "Monsoon Offer",
    "description": "Special discounts for monsoon season.",
    "price": 1500.00,
    "discount": 25.00,
    "discount_price": 1125.00,
    "start_date": "2025-06-01",
    "end_date": "2025-06-30",
    "status": "ACTIVE",
    "services": ["Anti Termite Treatment", "Rodent Pest Control"],
    "offer_banner": "http://example.com/media/offers/monsoon_offer.jpg"
  }
]
```

---

### **Notes**

- **Filter Logic**:
  - The endpoint filters offers with a status of `ACTIVE`, ensuring only currently available offers are shown.
  - The `status` field is case-insensitive (`status__iexact`).

- **Frontend Use**:
  - This endpoint is designed for website integration to display active offers to clients.

---

### **21. Check Employee Availability**

#### **21.1 Overview**
This endpoint checks if employees are available at a given date and time. It is used during the booking or offer booking process, allowing the user to select an alternative date and time if the selected slot is unavailable.

---

### **Endpoint Details**

#### **URL**: `/check-availability/`
#### **Method**: `GET`
#### **Authentication**: Not required.
#### **Authorization**: Open to all users.
#### **Description**: Checks whether employees are available at the specified date and time.

---

### **Request Parameters**

| Parameter        | Type       | Required | Description                              |
|------------------|------------|----------|------------------------------------------|
| `booking_date`   | String     | Yes      | The desired booking date (format: `YYYY-MM-DD`). |
| `booking_time`   | String     | Yes      | The desired booking time (format: `HH:MM`).       |

---

### **Response Fields**

| Field             | Type       | Description                              |
|-------------------|------------|------------------------------------------|
| `available`       | Boolean    | Indicates if employees are available (`true` or `false`). |
| `error`           | String     | Error message (only present if availability check fails). |

---

### **Request Examples**

#### **Valid Request**:
```
/check-availability/?booking_date=2025-05-10&booking_time=14:00
```

#### **Invalid Request (Missing Parameters)**:
```
/check-availability/
```

---

### **Response Examples**

#### **1. Employees Available**:
- **Status**: `200 OK`

```json
{
  "available": true
}
```

#### **2. Employees Unavailable**:
- **Status**: `200 OK`

```json
{
  "available": false
}
```

#### **3. Missing Parameters**:
- **Status**: `400 Bad Request`

```json
{
  "available": false,
  "error": "Missing date or time"
}
```

#### **4. Invalid Date/Time Format**:
- **Status**: `400 Bad Request`

```json
{
  "available": false,
  "error": "Invalid date/time format"
}
```

#### **5. Past Time Selected**:
- **Status**: `400 Bad Request`

```json
{
  "available": false,
  "error": "Selected time has already passed"
}
```

---

### **21.2 Backend Workflow**

1. **Input Validation**:
   - Checks if both `booking_date` and `booking_time` are provided.
   - Validates the format of the date and time.
   - Ensures the selected time is not in the past.

2. **Employee Availability Check**:
   - Calculates the 2-hour window for the selected time (`booking_datetime` to `end_time`).
   - Counts the total number of active employees.

3. **Booking Overlap Check**:
   - Identifies overlapping bookings in the 2-hour window.
   - Calculates the total number of employees required for overlapping bookings.
   - Verifies if the total employees required exceeds the available employees.

4. **Assignment Overlap Check**:
   - Identifies incomplete assignments overlapping with the selected time window.
   - Verifies if the total overlapping assignments exceed the available employees.

5. **Final Decision**:
   - Returns `{"available": true}` if both the booking and assignment checks pass.
   - Returns `{"available": false}` otherwise.

---

### **21.3 Notes**

- **Use Case**:
  - This endpoint is used on the website during the booking or offer booking process to help users select an available slot.
  
- **Error Handling**:
  - Provides detailed error messages for invalid inputs or unavailable slots.

### **22. Retrieve Latest Active Offer**

#### **22.1 Overview**
This endpoint retrieves the latest active offer to display on the website's main entry point. It is used for showing a popup with the most recent active offer.

---

### **Endpoint Details**

#### **URL**: `/latest-offer/`
#### **Method**: `GET`
#### **Authentication**: Not required.
#### **Authorization**: Open to all users.
#### **Description**: Fetches the latest active offer based on its start and end dates. If no active offer exists, a response indicating no active offers is returned.

---

### **Response Fields**

| Field             | Type       | Description                              |
|-------------------|------------|------------------------------------------|
| `id`              | Integer    | Unique ID of the offer.                  |
| `title`           | String     | Title of the offer.                      |
| `description`     | String     | Detailed description of the offer.       |
| `price`           | Decimal    | Original price for the service.          |
| `discount`        | Decimal    | Discount percentage.                     |
| `discount_price`  | Decimal    | Price after applying the discount.       |
| `start_date`      | Date       | Offer start date.                        |
| `end_date`        | Date       | Offer end date.                          |
| `status`          | String     | Status of the offer (`ACTIVE` or `EXPIRED`). |
| `services`        | List       | List of services applicable to the offer. |
| `offer_banner`    | URL        | URL to the offer banner image.           |

---

### **Request Example**

#### **GET**:
```
/latest-offer/
```

---

### **Response Examples**

#### **1. Latest Active Offer Found**:
- **Status**: `200 OK`

```json
{
  "id": 1,
  "title": "Spring Discount",
  "description": "Get 15% off on all pest control services.",
  "price": 1200.00,
  "discount": 15.00,
  "discount_price": 1020.00,
  "start_date": "2025-05-01",
  "end_date": "2025-05-10",
  "status": "ACTIVE",
  "services": ["Rodent Pest Control", "Anti Termite Treatment"],
  "offer_banner": "http://example.com/media/offers/spring_discount.jpg"
}
```

#### **2. No Active Offer**:
- **Status**: `204 No Content`

```json
{
  "detail": "No active offer."
}
```

---

### **22.2 Backend Workflow**

1. **Filter Active Offers**:
   - Filters offers with a status of `ACTIVE`.
   - Ensures the current date (`now`) falls between the `start_date` and `end_date`.

2. **Sorting**:
   - Orders the filtered offers by `-start_date` (most recent first).

3. **Retrieve Latest Offer**:
   - Retrieves the first offer from the sorted list.
   - If no active offers are found, a `204 No Content` response is returned.

4. **Serialization**:
   - If an offer is found, it is serialized and returned in the response.

---

### **22.3 Notes**

- **Use Case**:
  - This endpoint is specifically designed for the website's entry point to show a popup with the latest active offer.

- **Performance**:
  - The query is optimized to fetch only the latest active offer using sorting and filtering.


### **23. Booking Count**

#### **23.1 Overview**
This endpoint provides a summary of booking counts categorized by their status. It is primarily used for dashboards or reporting purposes.

---

### **Endpoint Details**

#### **URL**: `/booking-count/`
#### **Method**: `GET`
#### **Authentication**: Required (Bearer Token)
#### **Authorization**: All authenticated users can access this endpoint.
#### **Description**: Returns the total number of bookings and a breakdown of bookings by their status.

---

### **Response Fields**

| Field                     | Type    | Description                                |
|---------------------------|---------|--------------------------------------------|
| `total_bookings`          | Integer | Total number of bookings in the system.    |
| `pending_count`           | Integer | Number of bookings with the status `PENDING`. |
| `service_completed_count` | Integer | Number of bookings with the status `SERVICE_COMPLETED`. |

---

### **Request Example**

#### **GET**:
```
/booking-count/
```

---

### **Response Example**

#### **Success Response**:
- **Status**: `200 OK`

```json
{
  "total_bookings": 150,
  "pending_count": 25,
  "service_completed_count": 100
}
```

#### **Error Response (Unauthorized)**:
- **Status**: `401 Unauthorized`

```json
{
  "detail": "Authentication credentials were not provided."
}
```

---

### **23.2 Backend Workflow**

1. **Authentication**:
   - Ensures the user is authenticated before processing the request.

2. **Data Aggregation**:
   - Counts all bookings in the system (`total_bookings`).
   - Filters and counts bookings with:
     - `status="PENDING"` (`pending_count`).
     - `status="SERVICE_COMPLETED"` (`service_completed_count`).

3. **Response**:
   - Returns the aggregated counts in the response.

---

### **23.3 Notes**

- **Use Case**:
  - This endpoint is useful for admin dashboards to monitor booking statuses.
  
- **Performance**:
  - Optimized queries are used to ensure efficient data retrieval.

### **24. Booking Count by Date**

#### **24.1 Overview**
This endpoint provides a count of bookings based on a specific date or a date range. It is useful for viewing booking statistics for a specific day or period.

---

### **Endpoint Details**

#### **URL**: `/booking-count-by-date/`
#### **Method**: `GET`
#### **Authentication**: Required (Bearer Token)
#### **Authorization**: All authenticated users can access this endpoint.
#### **Description**: Returns the total count of bookings based on a single date, a date range, or all bookings if no date is provided.

---

### **Request Parameters**

| Parameter    | Type   | Required | Description                                |
|--------------|--------|----------|--------------------------------------------|
| `date`       | String | Optional | A specific date in `YYYY-MM-DD` format to get booking count for that day. |
| `start_date` | String | Optional | Start date in `YYYY-MM-DD` format for the date range. Must be provided with `end_date`. |
| `end_date`   | String | Optional | End date in `YYYY-MM-DD` format for the date range. Must be provided with `start_date`. |

- If no parameters are provided, the endpoint returns the total count of all bookings.

---

### **Response Fields**

| Field       | Type    | Description                           |
|-------------|---------|---------------------------------------|
| `count`     | Integer | The total count of bookings for the specified date, date range, or all bookings. |
| `error`     | String  | Error message (only present if the request fails). |

---

### **Request Examples**

#### **1. Count for a Single Date**:
```
/booking-count-by-date/?date=2025-05-01
```

#### **2. Count for a Date Range**:
```
/booking-count-by-date/?start_date=2025-05-01&end_date=2025-05-05
```

#### **3. Count for All Bookings**:
```
/booking-count-by-date/
```

---

### **Response Examples**

#### **1. Success Response (Single Date)**:
- **Status**: `200 OK`

```json
{
  "count": 15
}
```

#### **2. Success Response (Date Range)**:
- **Status**: `200 OK`

```json
{
  "count": 50
}
```

#### **3. Success Response (All Bookings)**:
- **Status**: `200 OK`

```json
{
  "count": 150
}
```

#### **4. Error Response (Invalid Date Format)**:
- **Status**: `400 Bad Request`

```json
{
  "error": "Invalid date format. Use YYYY-MM-DD."
}
```

---

### **24.2 Backend Workflow**

1. **Input Validation**:
   - Checks if `date`, `start_date`, or `end_date` parameters are provided.
   - Validates the format of the date(s) (`YYYY-MM-DD`).

2. **Query Logic**:
   - If `date` is provided:
     - Filters bookings created on the specified date.
   - If `start_date` and `end_date` are provided:
     - Filters bookings created within the specified date range (inclusive of the full `end_date` day).
   - If no parameters are provided:
     - Returns the total count of all bookings.

3. **Response**:
   - Returns the count of bookings based on the query.
   - Returns an error message if the date format is invalid.

---

### **24.3 Notes**

- **Use Case**:
  - This endpoint is ideal for generating reports or monitoring booking trends for a specific day or period.
  
- **Error Handling**:
  - Provides clear error messages for invalid date formats.
### **25. Generate Booking Link**

#### **25.1 Overview**
This endpoint generates a unique booking link for a specific booking and sends it to the client's phone number via SMS. It is primarily used by the admin panel to share booking information with clients.

---

### **Endpoint Details**

#### **URL**: `/generate-booking-link/`
#### **Method**: `POST`
#### **Authentication**: Required (Bearer Token)
#### **Authorization**: Only authenticated users can access this endpoint.
#### **Description**: Generates a secure booking link for a given booking ID and sends it to the client's registered phone number.

---

### **Request Body**

| Field        | Type    | Required | Description                         |
|--------------|---------|----------|-------------------------------------|
| `booking_id` | Integer | Yes      | The ID of the booking for which the link is to be generated. |

---

### **Response Fields**

| Field             | Type       | Description                                   |
|-------------------|------------|-----------------------------------------------|
| `booking_link`    | String     | The securely generated booking link.          |
| `booking_details` | Object     | Serialized details of the booking.            |
| `sms_sent`        | Boolean    | Indicates whether the SMS was successfully sent. |

---

### **Request Example**

#### **POST**:
```json
{
  "booking_id": 123
}
```

---

### **Response Examples**

#### **1. Successful Response**:
- **Status**: `200 OK`

```json
{
  "booking_link": "https://www.superstarpestcontrol.com/booking-info/secure_token_123/",
  "booking_details": {
    "id": 123,
    "full_name": "John Doe",
    "phone_number": "+911234567890",
    "email": "john.doe@example.com",
    "service_name": "General Pest Control",
    "booking_date": "2025-05-10",
    "booking_time": "14:00:00",
    "price": 1200.00
  },
  "sms_sent": true
}
```

#### **2. Missing Booking ID**:
- **Status**: `400 Bad Request`

```json
{
  "error": "Booking ID is required"
}
```

#### **3. Invalid Booking ID**:
- **Status**: `404 Not Found`

```json
{
  "detail": "Not found."
}
```

---

### **25.2 Backend Workflow**

1. **Input Validation**:
   - Ensures the `booking_id` is provided in the request body.

2. **Retrieve Booking**:
   - Retrieves the booking from the database using the provided `booking_id`.
   - Returns a `404 Not Found` response if the booking doesn't exist.

3. **Generate Booking Link**:
   - Creates a secure booking link using the booking's `secure_token`.

4. **Send SMS**:
   - Sends the booking link to the client's registered phone number using the `send_booking_link` function.
   - Updates the `booking_link_sent` field in the booking record to indicate the link has been sent.

5. **Serialize and Respond**:
   - Serializes the updated booking details.
   - Returns the generated booking link, booking details, and the SMS status in the response.

---

### **25.3 Notes**

- **Secure Booking Link**:
  - The booking link includes a `secure_token` for security purposes, preventing unauthorized access.

- **SMS Integration**:
  - The `send_booking_link` function is assumed to handle the SMS sending process and return the SMS status.

- **Use Case**:
  - This endpoint is designed for admin panel users to share booking details with clients via SMS.

### **26. Update Price and Generate Payment Link**

#### **26.1 Overview**
This endpoint allows authorized users (Admin, Manager, or Superuser) to update the booking price, calculate additional charges (GST, payment gateway charges), and generate a secure payment link. The generated payment link is then sent to the client's phone number via SMS.

---

### **Endpoint Details**

#### **URL**: `/update-price-and-generate-link/`
#### **Method**: `POST`
#### **Authentication**: Required (Bearer Token)
#### **Authorization**: 
- Only accessible by users with roles:
  - `ADMIN`
  - `MANAGER`
  - `SUPERUSER`

#### **Description**: Updates the booking price, calculates the total cost (including GST and payment gateway charges), generates a payment link, and sends the link via SMS to the client.

---

### **Request Body**

| Field        | Type    | Required | Description                                                |
|--------------|---------|----------|------------------------------------------------------------|
| `booking_id` | Integer | Yes      | The ID of the booking for which the price is to be updated. |
| `price`      | Float   | Yes      | The new price to update for the booking.                   |

---

### **Response Fields**

| Field                       | Type     | Description                                               |
|-----------------------------|----------|-----------------------------------------------------------|
| `message`                   | String   | Success message.                                          |
| `booking_id`                | Integer  | The ID of the updated booking.                           |
| `price`                     | Float    | The updated price of the booking.                        |
| `gst`                       | Float    | The calculated GST (18% of the price).                   |
| `payment_gateway_charges`   | Float    | The calculated payment gateway fee (2.6% of the price).  |
| `grand_total`               | Float    | The total cost (price + GST + payment gateway charges).   |
| `payment_link`              | String   | The generated secure payment link.                       |
| `sms_sent`                  | Boolean  | Whether the SMS was successfully sent.                   |

---

### **Request Example**

#### **POST**:
```json
{
  "booking_id": 123,
  "price": 1500.00
}
```

---

### **Response Examples**

#### **1. Success Response**:
- **Status**: `200 OK`

```json
{
  "message": "Price updated successfully and payment link generated.",
  "booking_id": 123,
  "price": 1500.0,
  "gst": 270.0,
  "payment_gateway_charges": 39.0,
  "grand_total": 1809.0,
  "payment_link": "https://www.superstarpestcontrol.com/booking-info/secure_token_123/",
  "sms_sent": true
}
```

#### **2. Missing Required Fields**:
- **Status**: `400 Bad Request`

```json
{
  "error": "Booking ID and price are required."
}
```

#### **3. Unauthorized Access**:
- **Status**: `403 Forbidden`

```json
{
  "error": "Unauthorized"
}
```

#### **4. Invalid Booking ID**:
- **Status**: `404 Not Found`

```json
{
  "detail": "Not found."
}
```

#### **5. Other Errors**:
- **Status**: `400 Bad Request`

```json
{
  "error": "An unexpected error occurred."
}
```

---

### **26.2 Backend Workflow**

1. **Input Validation**:
   - Ensures both `booking_id` and `price` are provided in the request.
   - Returns an error if either field is missing.

2. **Authorization Check**:
   - Verifies the user's role is one of `ADMIN`, `MANAGER`, or `SUPERUSER`.
   - Returns a `403 Forbidden` error for unauthorized users.

3. **Retrieve Booking**:
   - Fetches the booking record using the provided `booking_id`.
   - Returns a `404 Not Found` error if the booking doesn't exist.

4. **Price Update and Calculations**:
   - Updates the booking's `price` field.
   - Calculates:
     - GST (18% of the price).
     - Payment gateway charges (2.6% of the price).
     - Grand total (`price + GST + payment gateway charges`).
   - Saves the updated booking with all calculations.

5. **Generate Payment Link**:
   - Creates a secure payment link using the booking's `secure_token`.

6. **Send SMS**:
   - Sends the payment link to the client's registered phone number using the `send_payment_link_sms` function.
   - Updates the `booking_link_sent` field to indicate the link was sent.

7. **Response**:
   - Returns the updated booking details, payment link, and SMS status.

---

### **26.3 Notes**

- **Secure Payment Link**:
  - The link includes a `secure_token` for security purposes, ensuring only the client can access it.

- **SMS Integration**:
  - The `send_payment_link_sms` function handles the SMS sending process and returns the status.

- **Use Case**:
  - This endpoint is designed for admin panel users to update booking prices and share payment links with clients.



